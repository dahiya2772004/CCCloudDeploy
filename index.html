<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Price Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple loader animation */
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 md:p-8">
            <!-- Header Section -->
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">Stock Price Predictor</h1>
                <p class="text-gray-500 dark:text-gray-400 mt-2">Upload a CSV file with historical stock data to get a price prediction.</p>
            </div>

            <!-- File Upload Section -->
            <div class="flex flex-col items-center justify-center w-full">
                <label for="csv-file-input" class="flex flex-col items-center justify-center w-full h-48 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-bray-800 dark:bg-gray-700 hover:bg-gray-100 dark:hover:border-gray-500 dark:hover:bg-gray-600 transition-colors">
                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                        <svg class="w-10 h-10 mb-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                        </svg>
                        <p class="mb-2 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">CSV file (MAX. 5MB)</p>
                    </div>
                    <input id="csv-file-input" type="file" class="hidden" accept=".csv" />
                </label>
                <p id="file-name" class="mt-2 text-sm text-gray-500 dark:text-gray-400 h-5"></p>
            </div>

            <!-- Predict Button -->
            <div class="mt-6 text-center">
                <button id="predict-btn" class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:focus:ring-blue-800">
                    Predict Price
                </button>
            </div>

            <!-- Result Section -->
            <div id="result-container" class="mt-8 text-center min-h-[100px] flex items-center justify-center">
                <!-- Loader and result will be injected here by JS -->
            </div>
        </div>

        <!-- CSV Format Information -->
        <div class="mt-6 bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 md:p-8">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-3">Accepted CSV Formats</h2>
            <p class="text-gray-500 dark:text-gray-400 mb-4">
                The CSV file must contain a header row. The model will look for a column named `Close` or `Price` to base its prediction on. The code can automatically skip initial metadata rows.
            </p>
            <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-4 text-sm font-mono text-gray-700 dark:text-gray-300 overflow-x-auto">
                <span class="font-bold text-gray-800 dark:text-gray-200">Example 1: Standard OHLC Data</span>
                <pre class="mt-2">Date,Open,High,Low,Close,Volume
2023-01-01,150.10,152.40,149.80,152.05,120000
...
</pre>
                <span class="font-bold text-gray-800 dark:text-gray-200 mt-4 block">Example 2: Alternate Header (with metadata)</span>
                <pre class="mt-2">Price,Open,High,Low,Close,Volume
Ticker,YOUR.STOCK,YOUR.STOCK,YOUR.STOCK,YOUR.STOCK,YOUR.STOCK
2023-01-01,150.10,152.40,149.80,152.05,120000
...
</pre>
                <span class="font-bold text-gray-800 dark:text-gray-200 mt-4 block">Example 3: Simple Price Data</span>
                <pre class="mt-2">Date,Price
2023-01-01,152.05
...
</pre>
            </div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('csv-file-input');
        const predictBtn = document.getElementById('predict-btn');
        const fileNameDisplay = document.getElementById('file-name');
        const resultContainer = document.getElementById('result-container');

        let uploadedFile = null;

        // --- Event Listeners ---
        fileInput.addEventListener('change', (event) => {
            const files = event.target.files;
            if (files.length > 0) {
                uploadedFile = files[0];
                fileNameDisplay.textContent = `Selected file: ${uploadedFile.name}`;
            } else {
                uploadedFile = null;
                fileNameDisplay.textContent = '';
            }
        });

        predictBtn.addEventListener('click', () => {
            if (!uploadedFile) {
                displayError('Please select a CSV file first.');
                return;
            }
            processFile(uploadedFile);
        });
        
        // --- Core Functions ---

        /**
         * Reads the uploaded file and triggers the prediction process.
         * @param {File} file The CSV file uploaded by the user.
         */
        function processFile(file) {
            displayLoader();
            const reader = new FileReader();

            reader.onload = function(event) {
                try {
                    const csvText = event.target.result;
                    const data = parseCSV(csvText);
                    
                    if (data.prices.length < 5) {
                        displayError('Not enough data. Please provide a CSV with at least 5 rows of price data.');
                        return;
                    }

                    // Simulate a delay for the "model" to run
                    setTimeout(() => {
                        const prediction = predictPrice(data.prices);
                        displayPrediction(prediction);
                    }, 1500);

                } catch (error) {
                    console.error("Error processing file:", error);
                    displayError('Failed to parse CSV file. Please check the format.');
                }
            };

            reader.onerror = function() {
                displayError('Error reading the file.');
            };

            reader.readAsText(file);
        }

        /**
         * Parses CSV text into an array of price data.
         * Looks for 'Close' or 'Price' columns.
         * @param {string} text The raw text content of the CSV file.
         * @returns {{prices: number[]}} An object containing the extracted prices.
         */
        function parseCSV(text) {
            const lines = text.trim().split(/\r?\n/);
            if (lines.length < 2) throw new Error("CSV must have a header and at least one data row.");

            // Find the actual header row by looking for key terms. This handles files with extra metadata rows at the top.
            let headerIndex = 0; // Default to first line
            let headerFound = false;
            for(let i = 0; i < Math.min(lines.length, 5); i++) { // Check first 5 lines
                const potentialHeader = lines[i].toLowerCase();
                if (potentialHeader.includes('close') && potentialHeader.includes('open')) {
                    headerIndex = i;
                    headerFound = true;
                    break;
                }
            }

            // If a standard OHLC header wasn't found, check for a simple Price header
            if (!headerFound) {
                 for(let i = 0; i < Math.min(lines.length, 5); i++) { 
                    const potentialHeader = lines[i].toLowerCase();
                    if (potentialHeader.includes('price')) {
                        headerIndex = i;
                        break;
                    }
                }
            }

            const header = lines[headerIndex].split(',').map(h => h.trim().toLowerCase());
            const rows = lines.slice(headerIndex + 1);


            // Find the index of the price column ('close' or 'price')
            let priceIndex = header.indexOf('close');
            if (priceIndex === -1) {
                priceIndex = header.indexOf('price');
            }

            if (priceIndex === -1) {
                throw new Error("CSV header must contain a 'Close' or 'Price' column.");
            }

            const prices = rows.map(row => {
                const values = row.split(',');
                if (values.length <= priceIndex) {
                    return null; // Handle malformed or empty rows
                }
                const price = parseFloat(values[priceIndex]);
                return !isNaN(price) ? price : null;
            }).filter(p => p !== null); // Filter out any non-numeric or missing values

            return { prices };
        }

        /**
         * A *simplified mock function* to simulate a prediction.
         * A real implementation would use a library like TensorFlow.js here.
         * This function calculates the average of the last 5 days and adds some volatility.
         * @param {number[]} prices An array of historical prices.
         * @returns {number} The predicted price.
         */
        function predictPrice(prices) {
            // This is a placeholder for a real deep learning model.
            console.log("Simulating prediction model...");
            
            // Take the last 5 prices for a simple moving average
            const lastFivePrices = prices.slice(-5);
            const average = lastFivePrices.reduce((sum, price) => sum + price, 0) / lastFivePrices.length;

            // Add a small random factor to simulate market volatility/prediction
            const volatility = (Math.random() - 0.5) * (average * 0.05); // +/- 2.5% volatility
            
            const predictedPrice = average + volatility;
            
            return predictedPrice;
        }

        // --- UI Display Functions ---

        /** Displays the final prediction in the UI. */
        function displayPrediction(price) {
            resultContainer.innerHTML = `
                <div class="text-center animate-fade-in">
                    <p class="text-lg text-gray-500 dark:text-gray-400">Predicted Next Price:</p>
                    <p class="text-5xl font-bold text-green-500 mt-2">
                        ${price.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}
                    </p>
                </div>
            `;
        }

        /** Displays an error message in the UI. */
        function displayError(message) {
            resultContainer.innerHTML = `
                <div class="text-center animate-fade-in p-4 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 rounded-lg">
                    <p class="font-semibold text-red-800 dark:text-red-200">Error</p>
                    <p class="text-red-600 dark:text-red-300">${message}</p>
                </div>
            `;
        }

        /** Displays a loading spinner in the UI. */
        function displayLoader() {
            resultContainer.innerHTML = '<div class="loader"></div>';
        }

    </script>
</body>
</html>

